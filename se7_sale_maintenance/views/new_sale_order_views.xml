<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <menuitem id="new_sale_menu_root"
                  name="Maintenance/Repairs"
                  web_icon="maintenance,static/description/icon.png"/>

        <menuitem id="new_sale_order_menu"
                  name="Orders"
                  parent="new_sale_menu_root"
                  sequence="2"/>

        <record id="new_sale_order_view_search_inherit_quotation" model="ir.ui.view">
            <field name="name">new.sale.order.search.inherit.quotation</field>
            <field name="model">sale.order</field>
            <field name="mode">primary</field>
            <field name="inherit_id" ref="sale.sale_order_view_search_inherit_quotation"/>
            <field name="arch" type="xml">
                <xpath expr="//filter[@name='filter_order_date']" position="after">
                    <separator/>
                    <filter string="Maintenance" name="mantinance" domain="[('tipo_trabajo', '=', 'mantinance')]"/>
                    <filter string="Repairs" name="repair" domain="[('tipo_trabajo', '=', 'repair')]"/>
                </xpath>
            </field>
        </record>

        <record id="new_action_quotations_with_onboarding" model="ir.actions.act_window">
            <field name="name">Maintenance/Repairs Quotations</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">sale.order</field>
            <field name="view_type">form</field>
            <field name="view_id" ref="sale.view_quotation_tree_with_onboarding"/>
            <field name="view_mode">tree,kanban,form,calendar,pivot,graph,activity,timeline</field>
            <field name="search_view_id" ref="new_sale_order_view_search_inherit_quotation"/>
            <field name="context">{'search_default_my_quotation': 1, 'default_parte_de_trabajo': True,
                                   'default_tipo_trabajo': 'repair', 'default_es_instalacion': False}</field>
            <field name="domain">[('es_instalacion', '=', False)]</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Create a new quotation, the first step of a new sale!
                </p>
                <p>
                    Once the quotation is confirmed by the customer, it becomes a sales order.
                    <br/>
                    You will be able to create an invoice and collect the payment.
                </p>
            </field>
        </record>

        <record id="sale.action_quotations_with_onboarding" model="ir.actions.act_window">
            <field name="domain">[('es_instalacion', '=', True)]</field>
        </record>

        <menuitem id="menu_sale_quotations"
                  action="se7_sale_maintenance.new_action_quotations_with_onboarding"
                  parent="new_sale_order_menu"
                  sequence="1" groups="sales_team.group_sale_salesman"/>

        <record id="new_action_orders" model="ir.actions.act_window">
            <field name="name">Sales Orders</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">sale.order</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,kanban,form,calendar,pivot,graph,activity</field>
            <field name="search_view_id" ref="sale.sale_order_view_search_inherit_sale"/>
            <field name="context">
                {'default_parte_de_trabajo': True, 'default_tipo_trabajo': 'repair', 'default_es_instalacion': False}
            </field>
            <field name="domain">
                [('es_instalacion', '=', False), ('state', 'not in', ('draft', 'sent', 'cancel'))]
            </field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Create a new quotation, the first step of a new sale!
                </p>
                <p>
                    Once the quotation is confirmed, it becomes a sales order.
                    <br/>
                    You will be able to create an invoice and collect the payment.
                </p>
            </field>
        </record>

        <record id="sale.action_orders" model="ir.actions.act_window">
            <field name="domain">
                [('es_instalacion', '=', True), ('state', 'not in', ('draft', 'sent', 'cancel'))]
            </field>
        </record>

        <menuitem id="menu_sale_order"
                  name="Orders"
                  action="se7_sale_maintenance.new_action_orders"
                  parent="new_sale_order_menu"
                  sequence="2" groups="sales_team.group_sale_salesman"/>

        <menuitem id="new_menu_contract_sale" name="Contracts"
                  parent="new_sale_order_menu"
                  action="contract.action_customer_contract"
                  sequence="3"
                  groups="sales_team.group_sale_salesman"/>

        <menuitem id="new_res_partner_menu"
                  parent="new_sale_order_menu"
                  action="base.action_partner_form"
                  sequence="4" groups="sales_team.group_sale_salesman"/>

        <menuitem id="new_menu_sale_invoicing"
                  name="To Invoice"
                  parent="new_sale_menu_root"
                  sequence="3" groups="sales_team.group_sale_salesman"/>

        <record id="new_action_orders_to_invoice" model="ir.actions.act_window">
            <field name="name">Orders to Invoice</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">sale.order</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,calendar,graph,pivot,kanban,activity</field>
            <field name="context">{'create': False}</field>
            <field name="domain">[('es_instalacion', '=', False), ('invoice_status', '=', 'to invoice')]</field>
            <field name="search_view_id" ref="sale.view_sales_order_filter"/>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    No orders to invoice found
                </p>
                <p>
                    You can select all orders and invoice them in batch,
                    <br/>
                    or check every order and invoice them one by one.
                </p>
            </field>
        </record>

        <record id="sale.action_orders_to_invoice" model="ir.actions.act_window">
            <field name="domain">[('es_instalacion', '=', True),
                                  ('invoice_status', '=', 'to invoice')]</field>
        </record>

        <menuitem id="new_menu_sale_order_invoice"
                  action="se7_sale_maintenance.new_action_orders_to_invoice"
                  parent="new_menu_sale_invoicing"
                  sequence="2"/>

        <menuitem id="new_menu_sale_report"
                  name="Reporting"
                  parent="new_sale_menu_root"
                  sequence="5"
                  groups="sales_team.group_sale_manager"/>

        <record id="new_action_order_report_all" model="ir.actions.act_window">
            <field name="name">Sales Analysis</field>
            <field name="res_model">sale.report</field>
            <field name="view_type">form</field>
            <field name="view_mode">graph,pivot</field>
            <field name="view_id"></field>  <!-- force empty -->
            <field name="search_view_id" ref="sale.view_order_product_search"/>
            <field name="context">
                {'search_default_Sales': 1, 'group_by_no_leaf': 1, 'group_by': []}
            </field>
            <field name="domain">[('es_instalacion', '=', False)]</field>
            <field name="help">This report performs analysis on your quotations and sales orders. Analysis check your
                sales revenues and sort it by different group criteria (salesman, partner, product, etc.) Use this
                report to perform analysis on sales not having invoiced yet. If you want to analyse your turnover, you
                should use the Invoice Analysis report in the Accounting application.
            </field>
        </record>

        <record id="sale.action_order_report_all" model="ir.actions.act_window">
            <field name="domain">[('es_instalacion', '=', True)]</field>
        </record>

        <menuitem id="new_menu_report_product_all"
                  name="Sales"
                  action="se7_sale_maintenance.new_action_order_report_all"
                  parent="new_menu_sale_report"
                  sequence="1"/>

        <menuitem id="product_menu_catalog" name="Products"
                  action="sale.product_template_action" parent="new_sale_menu_root"
                  sequence="4" groups="sales_team.group_sale_salesman"/>


    </data>
</odoo>